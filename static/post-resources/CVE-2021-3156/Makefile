

BUILD_NAME=sudoedit-vuln
RUN_NAME=sudoedit1

.PHONY: all stop build run attach root
all: stop build run

build:
	docker build -t $(BUILD_NAME) .

# afl++ says:
# If you run fuzzing instances in docker, run them with "--security-opt seccomp=unconfined" for more speed.
run:
	docker run --rm \
		--security-opt seccomp=unconfined --cap-add=SYS_PTRACE --cap-add=IPC_OWNER \
		-v ./root-mounted:/root/mount \
		-v ./user-mounted:/home/user/mount \
		-d -i --name $(RUN_NAME) $(BUILD_NAME)

stop:
	docker stop $(RUN_NAME)

attach:
	docker exec -it $(RUN_NAME) /bin/bash

root:
	docker exec -u root -w /root -it $(RUN_NAME) /bin/bash
