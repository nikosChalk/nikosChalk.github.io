#!/bin/bash

# Run as user
# (host) echo core | sudo tee /proc/sys/kernel/core_pattern
set -e
INDIR=inputs-sudoedit
ODIR=outputs-sudoedit2
#rm -rf  $INDIR $ODIR
#mkdir -p $INDIR $ODIR

# Seed
echo -en 'sudoedit\x00-h\x00\x00' > $INDIR/1
echo -en 'sudoedit\x00-p\x00foobar\x00\x00' > $INDIR/2
# echo -en 'sudoedit\x00-s\x000123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!"#$%&'"'"'()*+,-./:;<=>?@[\]^_`{|}~\x00\x00' > $INDIR/3

# crashing input:
# echo -en 'sudoedit\x00-s\x001234\\\x00AAAAAAAAAAAAAAAAAAA\x00\x00' > $INDIR/4

export AFL_SKIP_CPUFREQ=1
# export AFL_DEBUG=1
afl-fuzz -i $INDIR -o $ODIR -M fuzzer01 -- /usr/local/bin/sudo-afl
